<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Administrador de IDs</title>
  <link href="https://fonts.googleapis.com/css2?family=Open+Sans&display=swap" rel="stylesheet">
  <style>
body {
  font-family: 'Open Sans', sans-serif;
  margin: 0;
  background: #f9f9f9;
  color: #333;
}

header {
  background-color: #0072C6;
  color: white;
  padding: 24px 20px;
  text-align: center;
  font-size: 1.5rem;
  font-weight: 600;
}

.container {
  max-width: 960px;
  margin: 40px auto;
  padding: 0 20px;
}

form, .card {
  background: #fff;
  padding: 24px;
  border-radius: 12px;
  box-shadow: 0 4px 10px rgba(0,0,0,0.05);
  margin-bottom: 30px;
}

input, select, textarea {
  width: 100%;
  padding: 14px;
  font-size: 16px;
  border: 1px solid #ccc;
  border-radius: 8px;
  box-sizing: border-box;
  margin-bottom: 20px;
}

textarea {
  min-height: 200px;
  resize: vertical;
}

button {
  background-color: #0072C6;
  color: #fff;
  padding: 12px 24px;
  font-size: 15px;
  border: none;
  border-radius: 8px;
  cursor: pointer;
  transition: background 0.3s ease;
}

button:hover {
  background-color: #005999;
}

.acciones {
  display: flex;
  gap: 10px;
  margin-top: 10px;
}

.acciones button {
  flex: 1;
}

.volver {
  display: block;
  margin: 20px auto;
  width: fit-content;
  text-decoration: none;
  color: #0072C6;
  font-weight: 500;
}

.volver:hover {
  text-decoration: underline;
}

.card {
  border-left: 4px solid #0072C6;
  padding-left: 20px;
}

.card h3 {
  margin: 0 0 10px;
}

.card p {
  margin: 5px 0;
}

.card .id {
  font-weight: bold;
  color: #555;
}

.form-grid {
  display: flex;
  flex-wrap: wrap;
  gap: 20px;
}

.col-izquierda {
  flex: 1;
  min-width: 250px;
}

.col-derecha {
  flex: 2;
}

.col-derecha textarea {
  width: 100%;
  height: 300px;
  box-sizing: border-box;
  resize: vertical;
}

@media (max-width: 768px) {
  .form-grid {
    flex-direction: column;
  }
}

input, textarea {

  padding: 14px;
  font-size: 16px;
  border: 2px solid #000; /* Borde negro más grueso */
  border-radius: 8px;
  background-color: #fff; /* Fondo blanco */
  color: #333;
  box-sizing: border-box;
  margin-bottom: 20px;
}

 select {
  width: 100%;
  padding: 14px;
  font-size: 16px;
  border: 2px solid #000; /* Borde negro más grueso */
  border-radius: 8px;
  background-color: #fff; /* Fondo blanco */
  color: #333;
  box-sizing: border-box;
  margin-bottom: 20px;
  appearance: none; /* Quita estilo por defecto en algunos navegadores */
  -webkit-appearance: none;
  -moz-appearance: none;
  background-image: url("data:image/svg+xml;utf8,<svg fill='black' height='24' viewBox='0 0 24 24' width='24' xmlns='http://www.w3.org/2000/svg'><path d='M7 10l5 5 5-5z'/></svg>");
  background-repeat: no-repeat;
  background-position: right 12px center;
  background-size: 16px;
}
select:focus {
  outline: none;
  box-shadow: 0 0 0 3px rgba(0, 0, 0, 0.3); /* Simula contorno negro alrededor del dropdown */
}
.descripcion {
  white-space: pre-wrap;
}

  </style>
</head>
<body>
  <header>
    <h1>Administrador</h1>
  </header>
  <!--<a class="volver" href="index.html">← Volver al buscador</a>-->

  <form id="formulario">
      <div class="form-grid">
        <div class="col-izquierda">
          <input type="text" id="id" placeholder="ID" required>
          <input type="text" id="titulo" placeholder="Título" required>
          <select id="categoria" required>
            <option value="">Selecciona una categoría</option>
            <option value="ID1">1.Constitución Política de Colombia 1991</option>
            <option value="ID2">2.Declaración Universal de Derechos Humanos 1948</option>
            <option value="ID3">3.Pacto Internacional de Derechos Civiles y Políticos 1966</option>
            <option value="ID4">4.Pacto Internacional de Derechos Económicos, Sociales y Culturales 1966</option>
            <option value="ID5">5.Declaración Americana de los Derechos y Deberes del Hombre 1948</option>
            <option value="ID6">6.Convención Americana sobre Derechos Humanos 1969</option>
            <option value="ID7">7.Protocolo Adicional a la Convención Americana en materia de Derechos Económicos, Sociales y Culturales 1988</option>
          </select>
        </div>
        <div class="col-derecha">
          <textarea id="descripcion" placeholder="Descripción" required></textarea>
        </div>
      </div>
      <button type="submit">Guardar</button>
    </form>
    
  <div class="container">
    <h3>Exportar una sola categoría</h3>
    <select id="exportarCategoria">
      <option value="">Selecciona una categoría</option>
      <option value="1.Constitución Política de Colombia 1991">1.Constitución Política de Colombia 1991</option>
      <option value="2.Declaración Universal de Derechos Humanos 1948">2.Declaración Universal de Derechos Humanos 1948</option>
      <option value="3.Pacto Internacional de Derechos Civiles y Políticos 1966">3.Pacto Internacional de Derechos Civiles y Políticos 1966</option>
      <option value="4.Pacto Internacional de Derechos Económicos, Sociales y Culturales 1966">4.Pacto Internacional de Derechos Económicos, Sociales y Culturales 1966</option>
      <option value="5.Declaración Americana de los Derechos y Deberes del Hombre 1948">5.Declaración Americana de los Derechos y Deberes del Hombre 1948</option>
      <option value="6.Convención Americana sobre Derechos Humanos 1969">6.Convención Americana sobre Derechos Humanos 1969</option>
      <option value="7.Protocolo Adicional a la Convención Americana en materia de Derechos Económicos, Sociales y Culturales 1988">7.Protocolo Adicional a la Convención Americana en materia de Derechos Económicos, Sociales y Culturales 1988</option>
    </select>
    <button onclick="exportarCategoriaSeleccionada()">Exportar categoría seleccionada</button>


    <h3>Filtrar visualización por categoría</h3>
    <select id="filtroCategoria" onchange="mostrarDatos()">
      <option value="">Todas las categorías</option>
      <option value="1.Constitución Política de Colombia 1991">1.Constitución Política de Colombia 1991</option>
      <option value="2.Declaración Universal de Derechos Humanos 1948">2.Declaración Universal de Derechos Humanos 1948</option>
      <option value="3.Pacto Internacional de Derechos Civiles y Políticos 1966">3.Pacto Internacional de Derechos Civiles y Políticos 1966</option>
      <option value="4.Pacto Internacional de Derechos Económicos, Sociales y Culturales 1966">4.Pacto Internacional de Derechos Económicos, Sociales y Culturales 1966</option>
      <option value="5.Declaración Americana de los Derechos y Deberes del Hombre 1948">5.Declaración Americana de los Derechos y Deberes del Hombre 1948</option>
      <option value="6.Convención Americana sobre Derechos Humanos 1969">6.Convención Americana sobre Derechos Humanos 1969</option>
      <option value="7.Protocolo Adicional a la Convención Americana en materia de Derechos Económicos, Sociales y Culturales 1988">7.Protocolo Adicional a la Convención Americana en materia de Derechos Económicos, Sociales y Culturales 1988</option>
    </select>

    
    <div id="lista"></div>
  </div>

  <script>
    let datos = [];

    const textosCategoria = {
      ID1: "1.Constitución Política de Colombia 1991",
      ID2: "2.Declaración Universal de Derechos Humanos 1948",
      ID3: "3.Pacto Internacional de Derechos Civiles y Políticos 1966",
      ID4: "4.Pacto Internacional de Derechos Económicos, Sociales y Culturales 1966",
      ID5: "5.Declaración Americana de los Derechos y Deberes del Hombre 1948",
      ID6: "6.Convención Americana sobre Derechos Humanos 1969",
      ID7: "7.Protocolo Adicional a la Convención Americana en materia de Derechos Económicos, Sociales y Culturales 1988"
    };

    const archivosJSON = [
      "1.constitucion_politica_de_colombia_1991.json",
      "2.declaracion_universal_de_derechos_humanos_1948.json",
      "3.pacto_internacional_de_derechos_civiles_y_politicos_1966.json",
      "4.pacto_internacional_de_derechos_economicos_sociales_y_culturales_1966.json",
      "5.declaracion_americana_de_los_derechos_y_deberes_del_hombre_1948.json",
      "6.convencion_americana_sobre_derechos_humanos_1969.json",
      "7.protocolo_adicional_a_la_convencion_americana_en_materia_de_derechos_economicos_sociales_y_culturales_1988.json"
    ];

    const form = document.getElementById('formulario');
    const lista = document.getElementById('lista');

    async function cargarTodosLosJSON() {
      let todosLosDatos = [];
      for (const archivo of archivosJSON) {
        try {
          const res = await fetch(`datos/${archivo}`);
          const contenido = await res.json();
          todosLosDatos = todosLosDatos.concat(contenido);
        } catch (e) {
          console.warn(`No se pudo cargar ${archivo}`, e);
        }
      }
      datos = todosLosDatos;
      mostrarDatos();
    }

    function mostrarDatos() {
      const filtro = document.getElementById("filtroCategoria")?.value || "";
      lista.innerHTML = '';

      datos
        .filter(item => !filtro || item.categoria === filtro)
        .sort((a, b) => parseInt(a.id) - parseInt(b.id))
        .forEach((item, index) => {
          const div = document.createElement('div');
          div.className = 'card';
          div.innerHTML = `
            <div class="id">ID: ${item.id}</div>
            <h3>${item.titulo}</h3>
            <p class="descripcion">${item.descripcion}</p>
            <p><strong>Categoría:</strong> ${item.categoria || "Sin categoría"}</p>
            <div class="acciones">
              <button onclick="editarPorId('${item.id}', '${item.categoria}')">Editar</button>
              <button onclick="eliminarPorId('${item.id}', '${item.categoria}')">Eliminar</button>
            </div>
          `;
          lista.appendChild(div);
        });
    }
    function editarPorId(id, categoria) {
      const index = datos.findIndex(item => item.id === id && item.categoria === categoria);
      if (index === -1) return;

      const item = datos[index];
      document.getElementById('id').value = item.id;
      document.getElementById('titulo').value = item.titulo;
      document.getElementById('descripcion').value = item.descripcion;

      const clave = Object.keys(textosCategoria).find(k => textosCategoria[k] === item.categoria);
      document.getElementById('categoria').value = clave || "";

      datos.splice(index, 1);
      mostrarDatos();
      form.scrollIntoView({ behavior: "smooth", block: "start" });
    }

    function eliminarPorId(id, categoria) {
      if (!confirm("¿Eliminar este registro?")) return;

      const index = datos.findIndex(item => item.id === id && item.categoria === categoria);
      if (index !== -1) {
        datos.splice(index, 1);
        mostrarDatos();
      }
    }

    document.getElementById("categoria").addEventListener("change", () => {
      const categoriaClave = document.getElementById("categoria").value;
      const categoriaTexto = textosCategoria[categoriaClave];

      // Filtrar artículos con esa categoría
      const articulosCategoria = datos.filter(item => item.categoria === categoriaTexto);

      // Obtener el máximo ID como número
      let maxId = 0;
      articulosCategoria.forEach(item => {
        const num = parseInt(item.id);
        if (!isNaN(num) && num >= maxId) {
          maxId = num;
        }
      });

      // Sugerir el siguiente
      document.getElementById("id").placeholder = `Sugerido: ${maxId + 1}`;
    });


    function editar(index) {
      const item = datos[index];
      document.getElementById('id').value = item.id;
      document.getElementById('titulo').value = item.titulo;
      document.getElementById('descripcion').value = item.descripcion;

      const clave = Object.keys(textosCategoria).find(k => textosCategoria[k] === item.categoria);
      document.getElementById('categoria').value = clave || "";

      datos.splice(index, 1);
      mostrarDatos();
      form.scrollIntoView({ behavior: "smooth", block: "start" });
    }

    function eliminar(index) {
      if (confirm("¿Eliminar este registro?")) {
        datos.splice(index, 1);
        mostrarDatos();
      }
    }

    form.addEventListener('submit', (e) => {
      e.preventDefault();
      const id = document.getElementById('id').value.trim();
      const titulo = document.getElementById('titulo').value.trim();
      const descripcion = document.getElementById('descripcion').value.trim();
      const categoriaClave = document.getElementById('categoria').value;
      const categoriaTexto = textosCategoria[categoriaClave] || "";

      // Verificar si ya existe el mismo ID en la misma categoría
      const idsEnCategoria = datos
        .filter(item => item.categoria === categoriaTexto)
        .map(item => parseInt(item.id))
        .filter(num => !isNaN(num));

      if (idsEnCategoria.includes(parseInt(id))) {
        const maxId = Math.max(...idsEnCategoria);
        alert(`Ya existe el ID "${id}" en la categoría "${categoriaTexto}".\n\nNúmero recomendado: ${maxId + 1}`);
        return;
      }

      datos.push({ id, titulo, descripcion, categoria: categoriaTexto });

      // Ordenar por ID para mantener consistencia
      datos.sort((a, b) => parseInt(a.id) - parseInt(b.id));
      form.reset();
      mostrarDatos();

    });

    function descargarJSON() {
      const categorias = {};

      // Agrupar datos por categoría
      datos.forEach(item => {
        const nombreCategoria = item.categoria || "Sin categoría";
        if (!categorias[nombreCategoria]) {
          categorias[nombreCategoria] = [];
        }
        categorias[nombreCategoria].push(item);
      });

      const nombresOrdenados = Object.keys(categorias)
        .sort((a, b) => a.localeCompare(b));

      nombresOrdenados.forEach((nombreCategoria, index) => {
        const datosCategoria = categorias[nombreCategoria];

        const datosNumerados = datosCategoria.map((item, idx) => ({
          ...item,
          titulo: item.titulo.replace(/^\d+\.\s*/, '')
        }));

        const blob = new Blob([JSON.stringify(datosNumerados, null, 2)], { type: "application/json" });

        const nombreLimpio = nombreCategoria
          .normalize("NFD").replace(/[\u0300-\u036f]/g, "") // quitar tildes
          .replace(/\s+/g, "_") // reemplazar espacios
          .replace(/[^a-zA-Z0-9_.]/g, "") // permitir punto
          .toLowerCase();

        const nombreArchivo = `${index + 1}.${nombreLimpio}.json`;

        const url = URL.createObjectURL(blob);
        const a = document.createElement("a");
        a.href = url;
        a.download = nombreArchivo;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
      });
    }



    cargarTodosLosJSON();
    function exportarCategoriaSeleccionada() {
      const categoriaSeleccionada = document.getElementById("exportarCategoria").value;
      if (!categoriaSeleccionada) {
        alert("Selecciona una categoría primero");
        return;
      }

      const datosFiltrados = datos.filter(item => item.categoria === categoriaSeleccionada);

      if (datosFiltrados.length === 0) {
        alert("No hay datos para esta categoría.");
        return;
      }

      const datosNumerados = datosFiltrados.map((item, idx) => ({
        ...item,
        titulo: item.titulo.replace(/^\d+\.\s*/, '')
      }));

      const blob = new Blob([JSON.stringify(datosNumerados, null, 2)], { type: "application/json" });

      // Mantener el número al inicio (antes del punto)
      const nombreLimpio = categoriaSeleccionada
        .normalize("NFD").replace(/[\u0300-\u036f]/g, "") // quitar tildes
        .replace(/\s+/g, "_") // espacios por guión bajo
        .replace(/[^a-zA-Z0-9_.]/g, "") // conservar puntos
        .toLowerCase();

      const nombreArchivo = `${nombreLimpio}.json`;

      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url;
      a.download = nombreArchivo;
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
    }


  </script>
</body>
</html>
